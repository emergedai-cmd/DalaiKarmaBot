// src/infra/is-main.js
import path from "node:path";
import { fileURLToPath } from "node:url";

/**
 * ESM-safe replacement for CommonJS `require.main === module`.
 *
 * Returns true when the current module file is the entrypoint script.
 * (Best-effort; safe + deterministic.)
 */
export function isMainModule(metaUrl = import.meta.url) {
  try {
    const thisFile = path.resolve(fileURLToPath(metaUrl));
    const entry = process.argv[1] ? path.resolve(process.argv[1]) : "";
    return Boolean(entry) && entry === thisFile;
  } catch {
    return false;
  }
}

export default isMainModule;
