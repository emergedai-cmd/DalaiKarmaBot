"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderOverview = renderOverview;
var lit_1 = require("lit");
var format_1 = require("../format");
var presenter_1 = require("../presenter");
function renderOverview(props) {
    var _a, _b, _c;
    var snapshot = (_a = props.hello) === null || _a === void 0 ? void 0 : _a.snapshot;
    var uptime = (snapshot === null || snapshot === void 0 ? void 0 : snapshot.uptimeMs) ? (0, format_1.formatDurationMs)(snapshot.uptimeMs) : "n/a";
    var tick = ((_b = snapshot === null || snapshot === void 0 ? void 0 : snapshot.policy) === null || _b === void 0 ? void 0 : _b.tickIntervalMs) ? "".concat(snapshot.policy.tickIntervalMs, "ms") : "n/a";
    var authHint = (function () {
        if (props.connected || !props.lastError) {
            return null;
        }
        var lower = props.lastError.toLowerCase();
        var authFailed = lower.includes("unauthorized") || lower.includes("connect failed");
        if (!authFailed) {
            return null;
        }
        var hasToken = Boolean(props.settings.token.trim());
        var hasPassword = Boolean(props.password.trim());
        if (!hasToken && !hasPassword) {
            return (0, lit_1.html)(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n        <div class=\"muted\" style=\"margin-top: 8px\">\n          This gateway requires auth. Add a token or password, then click Connect.\n          <div style=\"margin-top: 6px\">\n            <span class=\"mono\">openclaw dashboard --no-open</span> \u2192 tokenized URL<br />\n            <span class=\"mono\">openclaw doctor --generate-gateway-token</span> \u2192 set token\n          </div>\n          <div style=\"margin-top: 6px\">\n            <a\n              class=\"session-link\"\n              href=\"https://docs.openclaw.ai/web/dashboard\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              title=\"Control UI auth docs (opens in new tab)\"\n              >Docs: Control UI auth</a\n            >\n          </div>\n        </div>\n      "], ["\n        <div class=\"muted\" style=\"margin-top: 8px\">\n          This gateway requires auth. Add a token or password, then click Connect.\n          <div style=\"margin-top: 6px\">\n            <span class=\"mono\">openclaw dashboard --no-open</span> \u2192 tokenized URL<br />\n            <span class=\"mono\">openclaw doctor --generate-gateway-token</span> \u2192 set token\n          </div>\n          <div style=\"margin-top: 6px\">\n            <a\n              class=\"session-link\"\n              href=\"https://docs.openclaw.ai/web/dashboard\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              title=\"Control UI auth docs (opens in new tab)\"\n              >Docs: Control UI auth</a\n            >\n          </div>\n        </div>\n      "])));
        }
        return (0, lit_1.html)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n      <div class=\"muted\" style=\"margin-top: 8px\">\n        Auth failed. Re-copy a tokenized URL with\n        <span class=\"mono\">openclaw dashboard --no-open</span>, or update the token, then click Connect.\n        <div style=\"margin-top: 6px\">\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/web/dashboard\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Control UI auth docs (opens in new tab)\"\n            >Docs: Control UI auth</a\n          >\n        </div>\n      </div>\n    "], ["\n      <div class=\"muted\" style=\"margin-top: 8px\">\n        Auth failed. Re-copy a tokenized URL with\n        <span class=\"mono\">openclaw dashboard --no-open</span>, or update the token, then click Connect.\n        <div style=\"margin-top: 6px\">\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/web/dashboard\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Control UI auth docs (opens in new tab)\"\n            >Docs: Control UI auth</a\n          >\n        </div>\n      </div>\n    "])));
    })();
    var insecureContextHint = (function () {
        if (props.connected || !props.lastError) {
            return null;
        }
        var isSecureContext = typeof window !== "undefined" ? window.isSecureContext : true;
        if (isSecureContext) {
            return null;
        }
        var lower = props.lastError.toLowerCase();
        if (!lower.includes("secure context") && !lower.includes("device identity required")) {
            return null;
        }
        return (0, lit_1.html)(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n      <div class=\"muted\" style=\"margin-top: 8px\">\n        This page is HTTP, so the browser blocks device identity. Use HTTPS (Tailscale Serve) or open\n        <span class=\"mono\">http://127.0.0.1:18789</span> on the gateway host.\n        <div style=\"margin-top: 6px\">\n          If you must stay on HTTP, set\n          <span class=\"mono\">gateway.controlUi.allowInsecureAuth: true</span> (token-only).\n        </div>\n        <div style=\"margin-top: 6px\">\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/gateway/tailscale\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Tailscale Serve docs (opens in new tab)\"\n            >Docs: Tailscale Serve</a\n          >\n          <span class=\"muted\"> \u00B7 </span>\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/web/control-ui#insecure-http\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Insecure HTTP docs (opens in new tab)\"\n            >Docs: Insecure HTTP</a\n          >\n        </div>\n      </div>\n    "], ["\n      <div class=\"muted\" style=\"margin-top: 8px\">\n        This page is HTTP, so the browser blocks device identity. Use HTTPS (Tailscale Serve) or open\n        <span class=\"mono\">http://127.0.0.1:18789</span> on the gateway host.\n        <div style=\"margin-top: 6px\">\n          If you must stay on HTTP, set\n          <span class=\"mono\">gateway.controlUi.allowInsecureAuth: true</span> (token-only).\n        </div>\n        <div style=\"margin-top: 6px\">\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/gateway/tailscale\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Tailscale Serve docs (opens in new tab)\"\n            >Docs: Tailscale Serve</a\n          >\n          <span class=\"muted\"> \u00B7 </span>\n          <a\n            class=\"session-link\"\n            href=\"https://docs.openclaw.ai/web/control-ui#insecure-http\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            title=\"Insecure HTTP docs (opens in new tab)\"\n            >Docs: Insecure HTTP</a\n          >\n        </div>\n      </div>\n    "])));
    })();
    return (0, lit_1.html)(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n    <section class=\"grid grid-cols-2\">\n      <div class=\"card\">\n        <div class=\"card-title\">Gateway Access</div>\n        <div class=\"card-sub\">Where the dashboard connects and how it authenticates.</div>\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\n          <label class=\"field\">\n            <span>WebSocket URL</span>\n            <input\n              .value=", "\n              @input=", "\n              placeholder=\"ws://100.x.y.z:18789\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Gateway Token</span>\n            <input\n              .value=", "\n              @input=", "\n              placeholder=\"OPENCLAW_GATEWAY_TOKEN\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Password (not stored)</span>\n            <input\n              type=\"password\"\n              .value=", "\n              @input=", "\n              placeholder=\"system or shared password\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Default Session Key</span>\n            <input\n              .value=", "\n              @input=", "\n            />\n          </label>\n        </div>\n        <div class=\"row\" style=\"margin-top: 14px;\">\n          <button class=\"btn\" @click=", ">Connect</button>\n          <button class=\"btn\" @click=", ">Refresh</button>\n          <span class=\"muted\">Click Connect to apply connection changes.</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"card-title\">Snapshot</div>\n        <div class=\"card-sub\">Latest gateway handshake information.</div>\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\n          <div class=\"stat\">\n            <div class=\"stat-label\">Status</div>\n            <div class=\"stat-value ", "\">\n              ", "\n            </div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Uptime</div>\n            <div class=\"stat-value\">", "</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Tick Interval</div>\n            <div class=\"stat-value\">", "</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Last Channels Refresh</div>\n            <div class=\"stat-value\">\n              ", "\n            </div>\n          </div>\n        </div>\n        ", "\n      </div>\n    </section>\n\n    <section class=\"grid grid-cols-3\" style=\"margin-top: 18px;\">\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Instances</div>\n        <div class=\"stat-value\">", "</div>\n        <div class=\"muted\">Presence beacons in the last 5 minutes.</div>\n      </div>\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Sessions</div>\n        <div class=\"stat-value\">", "</div>\n        <div class=\"muted\">Recent session keys tracked by the gateway.</div>\n      </div>\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Cron</div>\n        <div class=\"stat-value\">\n          ", "\n        </div>\n        <div class=\"muted\">Next wake ", "</div>\n      </div>\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Notes</div>\n      <div class=\"card-sub\">Quick reminders for remote control setups.</div>\n      <div class=\"note-grid\" style=\"margin-top: 14px;\">\n        <div>\n          <div class=\"note-title\">Tailscale serve</div>\n          <div class=\"muted\">\n            Prefer serve mode to keep the gateway on loopback with tailnet auth.\n          </div>\n        </div>\n        <div>\n          <div class=\"note-title\">Session hygiene</div>\n          <div class=\"muted\">Use /new or sessions.patch to reset context.</div>\n        </div>\n        <div>\n          <div class=\"note-title\">Cron reminders</div>\n          <div class=\"muted\">Use isolated sessions for recurring runs.</div>\n        </div>\n      </div>\n    </section>\n  "], ["\n    <section class=\"grid grid-cols-2\">\n      <div class=\"card\">\n        <div class=\"card-title\">Gateway Access</div>\n        <div class=\"card-sub\">Where the dashboard connects and how it authenticates.</div>\n        <div class=\"form-grid\" style=\"margin-top: 16px;\">\n          <label class=\"field\">\n            <span>WebSocket URL</span>\n            <input\n              .value=", "\n              @input=", "\n              placeholder=\"ws://100.x.y.z:18789\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Gateway Token</span>\n            <input\n              .value=", "\n              @input=", "\n              placeholder=\"OPENCLAW_GATEWAY_TOKEN\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Password (not stored)</span>\n            <input\n              type=\"password\"\n              .value=", "\n              @input=", "\n              placeholder=\"system or shared password\"\n            />\n          </label>\n          <label class=\"field\">\n            <span>Default Session Key</span>\n            <input\n              .value=", "\n              @input=", "\n            />\n          </label>\n        </div>\n        <div class=\"row\" style=\"margin-top: 14px;\">\n          <button class=\"btn\" @click=", ">Connect</button>\n          <button class=\"btn\" @click=", ">Refresh</button>\n          <span class=\"muted\">Click Connect to apply connection changes.</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"card-title\">Snapshot</div>\n        <div class=\"card-sub\">Latest gateway handshake information.</div>\n        <div class=\"stat-grid\" style=\"margin-top: 16px;\">\n          <div class=\"stat\">\n            <div class=\"stat-label\">Status</div>\n            <div class=\"stat-value ", "\">\n              ", "\n            </div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Uptime</div>\n            <div class=\"stat-value\">", "</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Tick Interval</div>\n            <div class=\"stat-value\">", "</div>\n          </div>\n          <div class=\"stat\">\n            <div class=\"stat-label\">Last Channels Refresh</div>\n            <div class=\"stat-value\">\n              ", "\n            </div>\n          </div>\n        </div>\n        ", "\n      </div>\n    </section>\n\n    <section class=\"grid grid-cols-3\" style=\"margin-top: 18px;\">\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Instances</div>\n        <div class=\"stat-value\">", "</div>\n        <div class=\"muted\">Presence beacons in the last 5 minutes.</div>\n      </div>\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Sessions</div>\n        <div class=\"stat-value\">", "</div>\n        <div class=\"muted\">Recent session keys tracked by the gateway.</div>\n      </div>\n      <div class=\"card stat-card\">\n        <div class=\"stat-label\">Cron</div>\n        <div class=\"stat-value\">\n          ", "\n        </div>\n        <div class=\"muted\">Next wake ", "</div>\n      </div>\n    </section>\n\n    <section class=\"card\" style=\"margin-top: 18px;\">\n      <div class=\"card-title\">Notes</div>\n      <div class=\"card-sub\">Quick reminders for remote control setups.</div>\n      <div class=\"note-grid\" style=\"margin-top: 14px;\">\n        <div>\n          <div class=\"note-title\">Tailscale serve</div>\n          <div class=\"muted\">\n            Prefer serve mode to keep the gateway on loopback with tailnet auth.\n          </div>\n        </div>\n        <div>\n          <div class=\"note-title\">Session hygiene</div>\n          <div class=\"muted\">Use /new or sessions.patch to reset context.</div>\n        </div>\n        <div>\n          <div class=\"note-title\">Cron reminders</div>\n          <div class=\"muted\">Use isolated sessions for recurring runs.</div>\n        </div>\n      </div>\n    </section>\n  "])), props.settings.gatewayUrl, function (e) {
        var v = e.target.value;
        props.onSettingsChange(__assign(__assign({}, props.settings), { gatewayUrl: v }));
    }, props.settings.token, function (e) {
        var v = e.target.value;
        props.onSettingsChange(__assign(__assign({}, props.settings), { token: v }));
    }, props.password, function (e) {
        var v = e.target.value;
        props.onPasswordChange(v);
    }, props.settings.sessionKey, function (e) {
        var v = e.target.value;
        props.onSessionKeyChange(v);
    }, function () { return props.onConnect(); }, function () { return props.onRefresh(); }, props.connected ? "ok" : "warn", props.connected ? "Connected" : "Disconnected", uptime, tick, props.lastChannelsRefresh ? (0, format_1.formatAgo)(props.lastChannelsRefresh) : "n/a", props.lastError
        ? (0, lit_1.html)(templateObject_4 || (templateObject_4 = __makeTemplateObject(["<div class=\"callout danger\" style=\"margin-top: 14px;\">\n              <div>", "</div>\n              ", "\n              ", "\n            </div>"], ["<div class=\"callout danger\" style=\"margin-top: 14px;\">\n              <div>", "</div>\n              ", "\n              ", "\n            </div>"])), props.lastError, authHint !== null && authHint !== void 0 ? authHint : "", insecureContextHint !== null && insecureContextHint !== void 0 ? insecureContextHint : "") : (0, lit_1.html)(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n                <div class=\"callout\" style=\"margin-top: 14px\">\n                  Use Channels to link WhatsApp, Telegram, Discord, Signal, or iMessage.\n                </div>\n              "], ["\n                <div class=\"callout\" style=\"margin-top: 14px\">\n                  Use Channels to link WhatsApp, Telegram, Discord, Signal, or iMessage.\n                </div>\n              "]))), props.presenceCount, (_c = props.sessionsCount) !== null && _c !== void 0 ? _c : "n/a", props.cronEnabled == null ? "n/a" : props.cronEnabled ? "Enabled" : "Disabled", (0, presenter_1.formatNextRun)(props.cronNext));
}
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;
